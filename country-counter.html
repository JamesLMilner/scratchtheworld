<!-- Load the Polymer.Element base class -->
<link rel="import" href="bower_components/polymer/polymer-element.html">

<dom-module id="country-counter">
  <template>

    <!-- Styles MUST be inside template -->
    <style>

      #country-counter {
        width: 100%;
        height: 100%;
        text-align: center;
        margin: 0;
      }
      #percentage {
        padding-left: 1.5rem;
      }

    </style>

    <div id="country-counter">
      <strong>Countries Visited:</strong>
      [[visited]] / [[total]] <span id="percentage">([[percentage]]%)</span>
    </div>

  </template>

  <script>

    // Extend Polymer.Element base class
    class CountryCounter extends Polymer.Element {

      static get is() { return 'country-counter' }

      static get config() {
        // properties, observers meta data
        return {
            visited: 0,
            total : 0,
        };
      }

      connectedCallback() {
        super.connectedCallback();
        this.visited = 0;
        this.total = 0;
        document.addEventListener('totalCountries', this.setTotalCountries.bind(this));
        document.addEventListener('visitedCountries', this.setVisitedCountries.bind(this));
      } 

      setTotalCountries(data) {
        console.log(data.detail);
        this.total = data.detail.totalCountries;
        this.percentage = ((this.visited /  this.total) * 100).toFixed(2);
      }

      setVisitedCountries(data) {
        console.log(data.detail);
        this.visited = data.detail.visitedCountries;
        this.percentage = ((this.visited /  this.total) * 100).toFixed(2);
      }

    }

    // Register custom element definition using standard platform API
    customElements.define(CountryCounter.is, CountryCounter);

  </script>
</dom-module>
