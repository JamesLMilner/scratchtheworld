<!-- Load the Polymer.Element base class -->
<link rel="import" href="bower_components/polymer/polymer-element.html">

<dom-module id="visited-url">
  <template>

    <!-- Styles MUST be inside template -->
    <style>

      #visited-url {
        width: 100px;
        height: 100%;
        text-align: center;
        margin: 0;
        display: inline;
        margin-right: 0.5em;
        overflow-x: scroll;
      }

      #refresh-button {
          display: none;
          font-size: 18px;
          background-color: rgba(0,0,0,0);
          border: 1px solid #1a1a1a;
          vertical-align: middle;
          padding: 8px;
          margin-right: 20px;
          cursor: pointer;
          margin-bottom: 3px;
          background-color: rgba(255,255,255, 0.5);
      }

      .show {
        display: initial !important;
      }

      .hide {
        display: none !important;
      }

      strong {
        vertical-align: middle;
        font-size: 18px;
      }

      #url {
        font-size: 18px;
        margin-bottom: 0.5em;
        display: inline;
      }
   
    </style>

    <div id="visited-url">
      <strong>Share:</strong>
      <input id="url" readonly="readonly" value="[[url]]">
    </div>
    <button id="refresh-button" on-click="refreshPage"> Create your own! </button>

  </template>

  <script>

    // Extend Polymer.Element base class
    class VisitedUrl extends Polymer.Element {

      static get is() { return 'visited-url' }

      static get config() {
        // properties, observers meta data
        return {
            url : String,
            shared : Boolean
        };
      }

      connectedCallback() {
        super.connectedCallback();

        this.shared = window.location.search.indexOf('?countryCodes') > -1;
        const urlEl = this.shadowRoot.querySelector("#visited-url");
        const buttonEl = this.shadowRoot.querySelector("#refresh-button");
        if (this.shared) {
          urlEl.classList.add("hide");
          buttonEl.classList.add("show");
        }

        this.url = window.location.href;
        document.addEventListener('visitedUrl', this.setUrl.bind(this));
      } 

      refreshPage() {
        window.location = location.protocol + '//' + location.host + location.pathname;
      }

      setUrl(event, data) {
        this.url = event.detail.url;
      }

    }

    // Register custom element definition using standard platform API
    customElements.define(VisitedUrl.is, VisitedUrl);

  </script>
</dom-module>
